<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FluidNC GCode Viewer {{VERSION}}</title>
    <link rel="stylesheet" href="css/common.css">
    <link rel="stylesheet" href="css/fluidnc.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>üìê FluidNC GCode Viewer</h1>
        </header>

        <div class="mobile-tabs">
            <div class="mobile-tabs-nav">
                <button class="mobile-tab-button active" data-tab="settings">‚öôÔ∏è Settings</button>
                <button class="mobile-tab-button" data-tab="display">üìä Display</button>
                <button class="mobile-tab-button" data-tab="gcode">üìù GCode</button>
            </div>
        </div>

        <aside class="left-sidebar mobile-tab-content" data-tab-content="gcode">
            <div class="panel" id="gcode-panel" style="visibility: hidden; position: absolute;">
                <h3>GCode <span id="gcode-line-indicator" style="font-size: 12px; opacity: 0.7;"></span></h3>
                <div id="gcode-container">
                    <div id="gcode-content">
                        <div class="gcode-line-numbers" id="gcode-line-numbers"></div>
                        <div class="gcode-code" id="gcode-display"></div>
                    </div>
                </div>
            </div>
        </aside>

        <div class="canvas-container mobile-tab-content" data-tab-content="display">
            <div class="canvas-overlay-controls">
                <button id="btn-toggle-view">3D View</button>
                <button id="btn-reset-view" disabled>Reset View</button>
            </div>
            <canvas id="canvas2d"></canvas>
            <canvas id="canvas3d" class="hidden"></canvas>
            <canvas id="canvas3d-overlay" class="hidden"></canvas>
        </div>

        <aside class="sidebar mobile-tab-content active" data-tab-content="settings">
            <div class="panel">
                <h3>SD Card Files</h3>
                <div class="breadcrumb" id="breadcrumb">
                    <span class="breadcrumb-item" data-path="/">SD Card</span>
                </div>
                <div class="file-browser" id="file-browser">
                    <div style="padding: 20px; text-align: center; opacity: 0.7;">Loading files...</div>
                </div>
                <div style="margin-top: 10px; display: flex; gap: 10px;">
                    <button id="btn-load-file" disabled style="flex: 1;">Preview</button>
                    <button id="btn-run-file" disabled style="flex: 1;">Run</button>
                </div>
                <div class="progress-bar hidden" id="progress-bar">
                    <div class="progress-fill" id="progress-fill"></div>
                </div>
            </div>

            <div class="panel">
                <h3>Statistics</h3>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-label">Segments</div>
                        <div class="stat-value" id="stat-lines">-</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Est. Time</div>
                        <div class="stat-value" id="stat-time">-</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">X Range</div>
                        <div class="stat-value" id="stat-x">-</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Y Range</div>
                        <div class="stat-value" id="stat-y">-</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Z Range</div>
                        <div class="stat-value" id="stat-z">-</div>
                    </div>
                </div>
            </div>

            <div class="panel" id="tool-panel" style="display: none;">
                <h3>Tools</h3>
                <div id="tool-list" style="max-height: 400px; overflow-y: auto;">
                    <!-- Tool controls will be added dynamically -->
                </div>
            </div>

            <div class="panel" id="rapid-moves-panel" style="display: none;">
                <h3>Rapid Moves (G0)</h3>
                <div style="display: flex; align-items: center; gap: 8px; padding: 8px; background: var(--canvas-bg); border-radius: 4px;">
                    <input type="checkbox" id="rapid-moves-visible" checked>
                    <input type="color" id="rapid-move-color" value="#999999" style="width: 32px; height: 24px; border: none; cursor: pointer;">
                    <label for="rapid-moves-visible" style="flex: 1; font-size: 13px; cursor: pointer;">Show Travel Moves</label>
                </div>
            </div>

            <div class="panel">
                <h3>View Controls</h3>
                <div class="layer-controls">
                    <div style="margin-bottom: 10px;">
                        <label style="font-size: 12px; display: block; margin-bottom: 5px;">Theme</label>
                        <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                            <button id="theme-light" style="flex: 1; padding: 8px;">‚òÄÔ∏è Light</button>
                            <button id="theme-dark" style="flex: 1; padding: 8px;">üåô Dark</button>
                        </div>
                    </div>
                    <div style="margin-bottom: 10px;">
                        <label style="font-size: 12px; display: block; margin-bottom: 5px;">Zoom</label>
                        <input type="range" id="zoom-slider" min="0.1" max="10" step="0.1" value="1" style="width: 100%;">
                        <div style="text-align: center; font-size: 11px; margin-top: 5px;">
                            <span id="zoom-value">100%</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="panel" id="animation-panel" style="display: none;">
                <h3>Animation</h3>
                <div class="animation-controls">
                    <div class="controls-row">
                        <button id="btn-play">Play</button>
                        <button id="btn-reset">Reset</button>
                    </div>
                    <div class="controls-row">
                        <button id="btn-prev">‚óÄ Prev</button>
                        <button id="btn-next">Next ‚ñ∂</button>
                    </div>
                    <div>
                        <label>Speed: <span id="speed-label">1x</span></label>
                        <input type="range" id="speed-slider" min="-10" max="10" value="0" step="1">
                    </div>
                    <div style="margin-top: 10px;">
                        <label style="font-size: 12px; display: block; margin-bottom: 5px;">Segment: <span id="current-line">0</span> / <span id="total-lines">0</span></label>
                        <div style="font-size: 11px; opacity: 0.7; margin-bottom: 5px;">File Line: <span id="current-file-line">-</span></div>
                        <input type="range" id="line-slider" min="0" max="0" step="1" value="0" style="width: 100%;">
                    </div>
                </div>
            </div>

            <div class="panel">
                <h3>Layer Filter</h3>
                <div class="layer-controls">
                    <div class="layer-inputs">
                        <div>
                            <label style="font-size: 12px;">Min Z</label>
                            <input type="number" id="layer-min" step="0.1" placeholder="Auto">
                        </div>
                        <div>
                            <label style="font-size: 12px;">Max Z</label>
                            <input type="number" id="layer-max" step="0.1" placeholder="Auto">
                        </div>
                    </div>
                </div>
            </div>

            <div class="panel">
                <h3>3D Grid</h3>
                <div class="layer-controls">
                    <div style="margin-bottom: 10px;">
                        <label style="display: flex; align-items: center; gap: 8px;">
                            <input type="checkbox" id="grid-enabled" checked>
                            <span>Show Grid</span>
                        </label>
                    </div>
                    <div class="layer-inputs">
                        <div>
                            <label style="font-size: 12px;">Width (X)</label>
                            <input type="number" id="grid-width" step="10" value="1200" min="0">
                        </div>
                        <div>
                            <label style="font-size: 12px;">Height (Y)</label>
                            <input type="number" id="grid-height" step="10" value="2400" min="0">
                        </div>
                    </div>
                </div>
            </div>

            <div class="privacy-notice">
                üîí All processing happens locally in your browser.<br>No data is transmitted.
            </div>
        </aside>

        <footer>
            <div class="coordinate-display" id="coordinates">X: - Y: - Z: -</div>
            <div>Version {{VERSION}}</div>
        </footer>
    </div>

    <script src="js/fluidnc-api.js"></script>
    <script src="js/parser.js"></script>
    <script src="js/camera.js"></script>
    <script src="js/renderer2d.js"></script>
    <script src="js/renderer3d.js"></script>
    <script src="js/animator.js"></script>
    <script src="js/controller.js"></script>
    <script src="js/fluidnc-controller.js"></script>
</body>
</html>
